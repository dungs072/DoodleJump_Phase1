(()=>{"use strict";const t=class{constructor(){this.eventHandlers=new Map}addEventListener(t,e){this.eventHandlers.has(t)||this.eventHandlers.set(t,[]),this.eventHandlers.get(t).push(e)}removeEventListener(t,e){if(!this.eventHandlers.has(t))return;const s=this.eventHandlers.get(t),i=s.indexOf(e);-1!==i&&s.splice(i,1)}dispatchEvent(t,...e){if(!this.eventHandlers.has(t))return;const s=this.eventHandlers.get(t);for(const t of s)t(...e)}},e=class{constructor(t){this.isActive=!0,this.gameObject=t}getActive(){return this.isActive}setActive(t){this.isActive=t}getGameObject(){return this.gameObject}setGameObject(t){this.gameObject=t}removeGameObject(){this.gameObject=void 0}update(t){}draw(t,e){}};class s extends e{constructor(t){super(t),this.isTrigger=!1}setTopLeftBound(t){this.topLeftBound=t}setDownRightBound(t){this.downRightBound=t}setBounds(t,e){this.topLeftBound=t,this.downRightBound=e}getTopLeftBound(){return this.topLeftBound}getDownRightBound(){return this.downRightBound}setIsTrigger(t){this.isTrigger=t}getIsTrigger(){return this.isTrigger}setIsStatic(t){this.isStatic=t;const e=this.getGameObject();e&&(t?s.dispatcher.dispatchEvent("static",e):s.dispatcher.dispatchEvent("nonstatic",e))}removePhysic(){this.isStatic?s.dispatcher.dispatchEvent("removeStatic",this.getGameObject()):s.dispatcher.dispatchEvent("removeNonStatic",this.getGameObject())}getIsStatic(){return this.isStatic}hasCollision(t){if(this.isActive&&!this.isTrigger){const e=this.topLeftBound.x<t.topLeftBound.x+t.downRightBound.x&&this.topLeftBound.x+this.downRightBound.x>t.topLeftBound.x,s=this.topLeftBound.y<t.topLeftBound.y+t.downRightBound.y&&this.topLeftBound.y+this.downRightBound.y>t.topLeftBound.y;return e&&s}return!1}draw(t){}setOffset(t){this.offset=t}getOffset(){return this.offset}}s.dispatcher=new t;const i=s;class n{constructor(t,e){this.x=t,this.y=e}isZero(){return 0==this.x&&0==this.y}static add(t,e){return new n(t.x+e.x,t.y+e.y)}static subtract(t,e){return new n(t.x-e.x,t.y-e.y)}static multiply(t,e){return new n(t.x*e,t.y*e)}static devide(t,e){return 0==e?(console.log("Devide 0"),n.zero()):new n(t.x/e,t.y/e)}static up(){return new n(0,-1)}static down(){return new n(0,1)}static left(){return new n(-1,0)}static right(){return new n(1,0)}static zero(){return new n(0,0)}static one(){return new n(1,1)}}const o=n,r=class extends e{constructor(t){super(t),this.velocity=o.zero(),this.mass=1}addForce(t,e){this.velocity=o.add(this.velocity,o.multiply(t,e))}clampToZeroVelocity(t){this.velocity.x<0?this.velocity.x=Math.min(this.velocity.x+t,0):this.velocity.x>0&&(this.velocity.x=Math.max(this.velocity.x-t,0)),this.velocity.y<0?this.velocity.y=Math.min(this.velocity.y+t,0):this.velocity.y>0&&(this.velocity.y=Math.max(this.velocity.y-t,0))}canUseGravity(){return this.useGravity}setUseGravity(t){this.useGravity=t}getVelocity(){return this.velocity}setVelocity(t){this.velocity=t}getMass(){return this.mass}setMass(t){this.mass=t}},a=class extends e{constructor(t){super(t),this.position=new o(0,0),this.localPosition=new o(0,0),this.scale=new o(1,1)}getPosition(){return this.position}getLocalPosition(){return this.localPosition}getScale(){return this.scale}setPosition(t){var e;this.position=t,null===(e=this.getGameObject())||void 0===e||e.setChildsPosition(t)}setLocalPosition(t){this.localPosition=t}setScale(t){this.scale=t}},h=class{constructor(){this.physicObjs=[],this.notStaticPhysicObjs=[],this.start()}start(){i.dispatcher.addEventListener("static",(t=>{this.addPhysicObjs(t)})),i.dispatcher.addEventListener("nonstatic",(t=>{this.addNotStaticPhysicObj(t)})),i.dispatcher.addEventListener("removeStatic",(t=>{this.removePhysicObjs(t)})),i.dispatcher.addEventListener("removeNonStatic",(t=>{this.removeNotStaticPhysicObjs(t)}))}handleCorePhysic(t){for(let e=this.notStaticPhysicObjs.length-1;e>=0;e--)if(!this.notStaticPhysicObjs[e].getCanDestroy()){const s=this.notStaticPhysicObjs[e].getComponent(a);if(null==s)return;const n=this.notStaticPhysicObjs[e].getComponent(i);if(null==n)return;const h=new o(s.getPosition().x,s.getPosition().y+n.getOffset()),c=new o(s.getScale().x,s.getScale().y-n.getOffset());n.setBounds(h,c);for(let t=this.physicObjs.length-1;t>=0;t--){if(this.notStaticPhysicObjs[e]==this.physicObjs[t])continue;const s=this.physicObjs[t].getComponent(i);null!=s&&n.hasCollision(s)&&this.notStaticPhysicObjs[e].onCollisionEnter(this.physicObjs[t])}const l=this.notStaticPhysicObjs[e].getComponent(r);if(!l)return;if(l.getVelocity().isZero()){if(null==l?void 0:l.canUseGravity()){const e=l.getMass()*t*t*75,i=o.multiply(o.down(),e),n=o.add(s.getPosition(),i);s.setPosition(n)}}else{const e=o.multiply(l.getVelocity(),t),i=o.add(s.getPosition(),e);s.setPosition(i),l.clampToZeroVelocity(1e3*t)}}for(let t=this.physicObjs.length-1;t>=0;t--){const e=this.physicObjs[t].getComponent(i);if(null==e)continue;const s=this.physicObjs[t].getComponent(a);if(null==s)continue;const n=e.getDownRightBound();e.setBounds(s.getPosition(),n)}}addNotStaticPhysicObj(t){this.notStaticPhysicObjs.push(t)}addPhysicObjs(t){this.physicObjs.push(t)}removePhysicObjs(t){const e=this.physicObjs.indexOf(t);this.physicObjs.splice(e,1)}removeNotStaticPhysicObjs(t){const e=this.notStaticPhysicObjs.indexOf(t);this.notStaticPhysicObjs.splice(e,1)}getLengthPhysicObjs(){return this.physicObjs.length}getFirstLengthPhysicObjs(){return this.physicObjs[0]}clearData(){this.physicObjs=[]}},c=class{constructor(t){this.gameObjects=[],this.stickyGameObjects=[],this.name=t,this.canvasMoveX=0,this.canvasMoveY=0}start(){this.gameObjects.forEach((t=>{t.start()}))}update(t){for(let e=this.gameObjects.length-1;e>=0;e--)this.gameObjects[e]?this.gameObjects[e].getCanDestroy()||this.gameObjects[e].update(t):this.gameObjects.splice(e);for(let e=this.stickyGameObjects.length-1;e>=0;e--)this.stickyGameObjects[e]?this.stickyGameObjects[e].getCanDestroy()||this.stickyGameObjects[e].update(t):this.stickyGameObjects.splice(e)}draw(t){t.save(),this.stickyGameObjects.forEach((e=>{e&&!e.getCanDestroy()&&e.getActive()&&e.draw(t)})),t.translate(this.canvasMoveX,this.canvasMoveY),this.gameObjects.forEach((e=>{!e.getCanDestroy()&&e.getActive()&&e.draw(t)})),t.restore()}setActive(t){this.isActive=t}getIsActive(){return this.isActive}getSceneName(){return this.name}setSceneName(t){this.name=t}addGameObject(t){this.gameObjects.push(t),this.sortLayers()}sortLayers(){this.gameObjects.sort(((t,e)=>e.getLayer()-t.getLayer()))}addStickyGameObject(t){this.stickyGameObjects.push(t),this.stickyGameObjects.sort(((t,e)=>e.getLayer()-t.getLayer()))}removeGameObject(t){t.setCanDestroy(!0);const e=this.gameObjects.indexOf(t);this.gameObjects.splice(e,1)}removeStickyGameObject(t){t.setCanDestroy(!0);const e=this.gameObjects.indexOf(t);this.stickyGameObjects.splice(e,1)}setCanvasMoveX(t){this.canvasMoveX=t}setCanvasMoveY(t){this.canvasMoveY=t}};class l{constructor(){this.scenes=new Map}static getInstance(){return l.instance||(l.instance=new l),l.instance}addScene(t,e){this.scenes.has(t)?console.log("Scene name exists. Please change scene name to different one"):this.scenes.set(t,e)}getScene(t){return this.scenes.get(t)}removeScene(t){this.scenes.delete(t)}toggleSceneOn(t){this.scenes.forEach(((e,s)=>{e.setActive(s==t),s!=t||(this.currentActiveScene=e)}))}getCurrentActiveScene(){return this.currentActiveScene}}const u=l;class m{static getInstance(){return m.instance||(m.instance=new m),m.instance}constructor(){this.images=new Map}getImage(t){return this.images.get(t)}loadImage(t,e){const s=new Image;return s.src=t,this.images.set(e,s),s}}const g=m,d=class extends e{constructor(t,e){super(t),e&&(this.image=g.getInstance().getImage(e))}draw(t,e){this.isActive&&this.image&&t.drawImage(this.image,e.x,e.y)}setImage(t){this.image=g.getInstance().getImage(t)}};class p{}p.Arial="20px Arial";const y=p;class P extends d{constructor(t,e,s,i){super(t,i),this.text=e,this.textColor=s,P.eventDispatcher.dispatchEvent("onAddButton",this)}draw(t,e){super.draw(t,e),t.fillStyle=this.textColor,t.font=y.Arial,t.textAlign="center",t.textBaseline="middle",t.fillText(this.text,e.x,e.y)}subscribe(t){this.callback=t}onClick(){this.callback()}}P.eventDispatcher=new t;const f=P,O=class{constructor(){this.buttons=[],this.start()}start(){f.eventDispatcher.addEventListener("onAddButton",(t=>{this.addButton(t)}))}handleClick(t){this.buttons.forEach((e=>{var s;if(e.getActive()){const i=null===(s=e.getGameObject())||void 0===s?void 0:s.getComponent(a);i&&t.x>i.getPosition().x&&t.x<i.getPosition().x+i.getScale().x&&t.y>i.getPosition().y&&t.y<i.getPosition().y+i.getScale().y&&e.onClick()}}))}addButton(t){this.buttons.push(t)}removeButton(t){const e=this.buttons.indexOf(t);this.buttons.splice(e,1)}},v=class{constructor(t,e){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=t,this.canvas.height=e,this.lastRenderTime=0,this.sceneManager=u.getInstance(),this.physicManager=new h,this.buttonManager=new O,document.body.appendChild(this.canvas),this.start()}start(){this.setEvents(),this.gameLoop()}createScene(t){const e=new c(t);return this.sceneManager.addScene(e.getSceneName(),e),this.sceneManager.toggleSceneOn(t),e.start(),e}gameLoop(){const t=performance.now(),e=(t-this.lastRenderTime)/1e3;this.lastRenderTime=t,this.clearCanvas(),this.update(e),this.render(),requestAnimationFrame((()=>this.gameLoop()))}update(t){const e=this.sceneManager.getCurrentActiveScene();e&&(this.physicManager.handleCorePhysic(t),e.update(t))}render(){const t=this.sceneManager.getCurrentActiveScene();t&&t.draw(this.context)}setEvents(){this.canvas.addEventListener("click",(t=>{const e=this.canvas.getBoundingClientRect(),s=t.clientX-e.left,i=t.clientY-e.top;this.buttonManager.handleClick(new o(s,i))}))}getCanvas(){return this.canvas}clearCanvas(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}};var A;!function(t){t[t.GAME_OVER=0]="GAME_OVER",t[t.GAME_PLAY=1]="GAME_PLAY",t[t.MAIN_MENU=2]="MAIN_MENU"}(A||(A={}));const S=A,M=class{constructor(){this.subscribers=[]}subscribe(t){this.subscribers.push(t)}unsubscribe(t){const e=this.subscribers.indexOf(t);e>-1&&this.subscribers.splice(e,1)}notify(){for(let t of this.subscribers)t.receive(this.data)}setData(t){this.data=t}getData(){return this.data}getSubscribers(){return this.subscribers}},L=class{};class T{constructor(){this.path="./assets/images/",this.resource=g.getInstance(),this.loadImages()}loadImages(){this.resource.loadImage(this.path+T.BACKGROUND,T.BACKGROUND),this.resource.loadImage(this.path+T.STABLE_PLATFORM,T.STABLE_PLATFORM),this.resource.loadImage(this.path+T.MOVABLE_PLATFORM,T.MOVABLE_PLATFORM),this.resource.loadImage(this.path+T.UNSTABLE_PLATFORM,T.UNSTABLE_PLATFORM),this.resource.loadImage(this.path+T.UNSTABLE_PLATFORM1,T.UNSTABLE_PLATFORM1),this.resource.loadImage(this.path+T.UNSTABLE_PLATFORM2,T.UNSTABLE_PLATFORM2),this.resource.loadImage(this.path+T.UNSTABLE_PLATFORM3,T.UNSTABLE_PLATFORM3),this.resource.loadImage(this.path+T.FORWARD_JUMP,T.FORWARD_JUMP),this.resource.loadImage(this.path+T.FORWARD_JUMP,T.FORWARD_JUMP),this.resource.loadImage(this.path+T.FORWARD_NORMAL,T.FORWARD_NORMAL),this.resource.loadImage(this.path+T.LEFT_JUMP,T.LEFT_JUMP),this.resource.loadImage(this.path+T.LEFT_NORMAL,T.LEFT_NORMAL),this.resource.loadImage(this.path+T.RIGHT_JUMP,T.RIGHT_JUMP),this.resource.loadImage(this.path+T.RIGHT_NORMAL,T.RIGHT_NORMAL),this.resource.loadImage(this.path+T.MENU_BUTTON,T.MENU_BUTTON),this.resource.loadImage(this.path+T.PLAY_AGAIN_BUTTON,T.PLAY_AGAIN_BUTTON),this.resource.loadImage(this.path+T.PLAY_GAME,T.PLAY_GAME),this.resource.loadImage(this.path+T.DOODLE_JUMP_TEXT,T.DOODLE_JUMP_TEXT),this.resource.loadImage(this.path+T.SHOE,T.SHOE),this.resource.loadImage(this.path+T.SHOE1,T.SHOE1),this.resource.loadImage(this.path+T.SHOE2,T.SHOE2),this.resource.loadImage(this.path+T.SHOE3,T.SHOE3),this.resource.loadImage(this.path+T.SHOE4,T.SHOE4),this.resource.loadImage(this.path+T.PROPELLER,T.PROPELLER),this.resource.loadImage(this.path+T.PROPELLER1,T.PROPELLER1),this.resource.loadImage(this.path+T.PROPELLER2,T.PROPELLER2),this.resource.loadImage(this.path+T.PROPELLER3,T.PROPELLER3),this.resource.loadImage(this.path+T.BULLET,T.BULLET)}getImage(t){return this.resource.getImage(t)}}T.BACKGROUND="bck.png",T.STABLE_PLATFORM="stable.png",T.MOVABLE_PLATFORM="movable.png",T.UNSTABLE_PLATFORM="unstable.png",T.UNSTABLE_PLATFORM1="unstable1.png",T.UNSTABLE_PLATFORM2="unstable2.png",T.UNSTABLE_PLATFORM3="unstable3.png",T.FORWARD_JUMP="forwardJump.png",T.FORWARD_NORMAL="forwardNormal.png",T.LEFT_JUMP="leftJump.png",T.LEFT_NORMAL="leftNormal.png",T.RIGHT_JUMP="rightJump.png",T.RIGHT_NORMAL="rightNormal.png",T.MENU_BUTTON="menuButton.png",T.PLAY_AGAIN_BUTTON="playAgainButton.png",T.PLAY_GAME="playGameButton.png",T.DOODLE_JUMP_TEXT="doodleJumpText.png",T.SHOE="shoe.png",T.SHOE1="shoe1.png",T.SHOE2="shoe2.png",T.SHOE3="shoe3.png",T.SHOE4="shoe4.png",T.PROPELLER="propeller.png",T.PROPELLER1="propeller1.png",T.PROPELLER2="propeller2.png",T.PROPELLER3="propeller3.png",T.BULLET="bullet.png";const x=T,w=class{constructor(t=!1){this.components=new Map,this.layer=0,this.initGameObject(t)}initGameObject(t){this.children=[],this.transform=new a(this),this.addComponent(this.transform),this.isActive=!0,this.canDestroy=!1,this.registerToScene(t)}registerToScene(t){const e=u.getInstance().getCurrentActiveScene();t?e.addStickyGameObject(this):e.addGameObject(this)}start(){}update(t){this.isActive&&this.components.forEach((e=>{e.getActive()&&e.update(t)}))}draw(t){this.isActive&&this.components.forEach((e=>{e.getActive()&&e.draw(t,this.transform.getPosition())}))}getComponent(t){return this.components.get(t)}addComponent(t){t.setGameObject(this),this.components.set(t.constructor,t)}removeComponent(t){t.removeGameObject(),this.components.delete(t.constructor)}onCollisionEnter(t){}setActive(t){this.isActive=t,this.components.forEach((e=>{e.setActive(t)})),this.children.forEach((e=>{e.setActive(t)}))}getActive(){return this.isActive}getCanDestroy(){return this.canDestroy}destroy(){this.parent&&this.parent.removeChild(this),this.handlePhysic(),this.children.forEach((t=>{t.destroy()})),this.components.clear(),u.getInstance().getCurrentActiveScene().removeGameObject(this)}setCanDestroy(t){t&&this.handlePhysic(),this.children.forEach((e=>{e.setCanDestroy(t)})),this.children=[],this.canDestroy=t}handlePhysic(){const t=this.getComponent(i);null==t||t.removePhysic()}getLayer(){return this.layer}setLayer(t){this.layer=t}setParent(t){this.parent=t}getParent(){return this.parent}addChild(t){this.children.push(t),this.transform.setPosition(this.transform.getPosition()),t.setParent(this)}removeChild(t){const e=this.children.indexOf(t);this.children.splice(e,1)}setChildsPosition(t){this.children.forEach((e=>{e.transform.setPosition(new o(t.x+e.transform.getLocalPosition().x,t.y+e.transform.getLocalPosition().y))}))}},R=class{move(t,e,s,i){if(null==i)return;const n=o.multiply(e,t*s),r=o.add(null==i?void 0:i.getPosition(),n);i.setPosition(r)}},b=class extends w{constructor(t){super(),this.sprite=t,this.addComponent(t),this.transform.setLocalPosition(new o(0,0)),this.setLayer(1)}getSprite(){return this.sprite}},E=class extends w{constructor(t,e,s){super(),this.transform=this.getComponent(a),this.transform.setPosition(t),this.transform.setScale(e),this.initHeight=600,this.borderHeight=0,this.borderHeight=0,this.canDestroy=!1,this.canJump=s,this.start()}start(){var t;this.collider=new i(this);const e=new o(this.transform.getScale().x,this.transform.getScale().y-25);this.collider.setBounds(null===(t=this.transform)||void 0===t?void 0:t.getPosition(),e),this.addComponent(this.collider),this.collider.setIsStatic(!0),this.movement=new R}update(t){super.update(t),this.initHeight-this.transform.getPosition().y<this.borderHeight&&(this.destroy(),this.item&&!this.item.getParent()&&(this.item.destroy(),this.item=null))}setUpModel(t){this.platformModel=new b(t),this.addChild(this.platformModel)}receive(t){this.borderHeight=t}operation(){console.log("nothing")}getGameObject(){return this}getCanJump(){return this.canJump}getTransform(){return this.transform}setItem(t){this.item=t}},I=class extends E{constructor(t,e){super(t,e,!0),this.canJump=!0,this.horizontalSpeed=100,this.maxLeft=this.transform.getPosition().x-100,this.maxRight=this.transform.getPosition().x+100;const s=new d(this,x.MOVABLE_PLATFORM);this.setUpModel(s)}update(t){super.update(t),this.transform.getPosition().x<this.maxLeft&&(this.canMoveLeft=!1),this.transform.getPosition().x>this.maxRight&&(this.canMoveLeft=!0),this.canMoveLeft?this.movement.move(t,o.left(),this.horizontalSpeed,this.transform):this.movement.move(t,o.right(),this.horizontalSpeed,this.transform);const e=this.platformModel.getComponent(a);e&&e.setPosition(this.transform.getPosition())}operation(){}},C=class extends L{createProduct(t,e){return new I(t,e)}},B=class extends E{constructor(t,e){super(t,e,!0),this.canJump=!0;const s=new d(this,x.STABLE_PLATFORM);this.setUpModel(s)}operation(){}},U=class extends L{createProduct(t,e){return new B(t,e)}},G=class extends e{constructor(t,e,s){super(t),this.isDone=!0,this.sprites=[];for(let s=0;s<e.length;s++){let i=new d(t,e[s]);this.sprites.push(i)}this.canLoop=!1,this.maxTimePerSprite=s,this.currentTime=s,this.currentIndex=0,this.isPlaying=!1}update(t){this.isDone||(this.isPlaying=!0,this.currentTime+=t,this.currentTime>=this.maxTimePerSprite&&(this.currentIndex=(this.currentIndex+1)%this.sprites.length,this.currentTime=0),this.isDone=!this.canLoop&&this.currentIndex==this.sprites.length-1)}draw(t,e){this.isPlaying&&this.sprites[this.currentIndex].draw(t,e)}setCanLoop(t){this.canLoop=t}play(){this.isDone=!1}stop(){this.isDone=!0}},_=class extends E{constructor(t,e){super(t,e,!1),this.canJump=!1,this.dropDownSpeed=200,this.isStomped=!1,this.maxDropDownDistance=100,this.canDestroy=!1,this.setLayer(1);const s=new d(this,x.UNSTABLE_PLATFORM);this.setUpModel(s),this.setUpAnimation()}setUpAnimation(){const t=[];t.push(x.UNSTABLE_PLATFORM),t.push(x.UNSTABLE_PLATFORM1),t.push(x.UNSTABLE_PLATFORM2),t.push(x.UNSTABLE_PLATFORM3),this.animation=new G(this,t,.02),this.addComponent(this.animation)}update(t){super.update(t),this.isStomped&&!this.canDestroy&&(this.platformModel.setActive(!1),this.transform.getPosition().y>=this.previousY+this.maxDropDownDistance&&this.destroy(),this.movement.move(t,o.down(),this.dropDownSpeed,this.transform))}operation(){this.isStomped=!0,this.previousY=this.transform.getPosition().y,this.animation.play()}},D=class extends L{createProduct(t,e){return new _(t,e)}},F=class extends w{constructor(t){super(),this.sprite=t,this.addComponent(t),this.transform.setLocalPosition(new o(0,0)),this.setLayer(1)}getSprite(){return this.sprite}},N=class extends w{constructor(t,e){super(),this.transform=this.getComponent(a),this.transform.setPosition(t),this.transform.setScale(e),this.canImplement=!1,this.timeToDestroy=4,this.currentTime=0,this.setLayer(0),this.start()}start(){var t;this.collider=new i(this);const e=new o(this.transform.getScale().x,this.transform.getScale().y);this.collider.setBounds(null===(t=this.transform)||void 0===t?void 0:t.getPosition(),e),this.addComponent(this.collider),this.collider.setIsStatic(!0)}update(t){super.update(t),this.canImplement&&(this.itemModel.setActive(!1),this.currentTime+=t,this.currentTime>this.timeToDestroy&&this.destroy())}operation(){this.canImplement=!0,this.collider.setActive(!1)}setUpModel(t){this.itemModel=new F(t),this.addChild(this.itemModel)}receive(t){this.canImplement=!0}getGameObject(){return this}getTransform(){return this.transform}},j=class extends N{constructor(t,e){super(t,e),this.forceAmount=1200,this.setUpAnimation();const s=new d(this,x.SHOE1);this.setUpModel(s)}setUpAnimation(){const t=[];t.push(x.SHOE1),t.push(x.SHOE2),t.push(x.SHOE3),t.push(x.SHOE4),this.animation=new G(this,t,.02),this.addComponent(this.animation)}getForceAmount(){return this.forceAmount}operation(){super.operation(),this.animation.play()}},H=class extends L{createProduct(t,e){return new j(t,e)}},J=class extends N{constructor(t,e){super(t,e),this.maxDistanceFlight=1500,this.flySpeed=600,this.timeToDestroy=this.maxDistanceFlight/this.flySpeed,this.setUpAnimation();const s=new d(this,x.PROPELLER);this.setUpModel(s)}setUpAnimation(){const t=[];t.push(x.PROPELLER1),t.push(x.PROPELLER2),t.push(x.PROPELLER3),this.animation=new G(this,t,.02),this.animation.setCanLoop(!0),this.addComponent(this.animation)}getMaxDistanceFlight(){return this.maxDistanceFlight}getFlySpeed(){return this.flySpeed}operation(){super.operation(),this.animation.play()}},k=class extends L{createProduct(t,e){return new J(t,e)}},Y=class{constructor(){this.publisher=new M,this.platforms=[],this.items=[],this.previousYPosition=500,this.maxPlatform=25,this.platformCreators=[],this.platformCreators.push(new U),this.platformCreators.push(new D),this.platformCreators.push(new C),this.itemCreators=[],this.itemCreators.push(new H),this.itemCreators.push(new k)}getPublisher(){return this.publisher}addPlatform(t){this.platforms.push(t)}createPlatforms(t){for(let e=0;e<this.maxPlatform-this.platforms.length;e++){const e=new o(120,35),s=this.getRandomInRange(100,200),i=Math.random()*(t-e.x),n=new o(i,this.previousYPosition-s),r=Math.floor(Math.random()*this.platformCreators.length),a=this.platformCreators[r].createProduct(n,e).getGameObject();if(a instanceof B&&Math.random()>.3){const t=this.createRandomItem(new o(n.x+30,n.y-20),new o(50,16));a.setItem(t)}if(a instanceof E&&(this.platforms.push(a),this.publisher.subscribe(a)),a instanceof _){let s=0;s=i-e.x>0?this.getRandomInRange(0,i-e.x):this.getRandomInRange(i+e.x,t-e.x);const n=this.getRandomInRange(100,150),r=new o(s,this.previousYPosition-n);this.createStablePlatform(r,e)}const h=this.getTheLastPlatform();null!=h&&(this.previousYPosition=h.getTransform().getPosition().y)}}createRandomItem(t,e){const s=Math.floor(Math.random()*this.itemCreators.length),i=this.itemCreators[s].createProduct(t,e).getGameObject();return i instanceof N&&this.items.push(i),i}createStablePlatform(t,e){const s=this.platformCreators[0].createProduct(t,e).getGameObject();return s instanceof E&&(this.platforms.push(s),this.publisher.subscribe(s)),s}getTheLastPlatform(){return 0==this.platforms.length?null:this.platforms[this.platforms.length-1]}getTheFirstPlatform(){return 0==this.platforms.length?null:this.platforms[0]}destroyPlatforms(){for(let t=this.platforms.length-1;t>=0;t--)this.platforms[t]?this.platforms[t].getCanDestroy()&&(this.publisher.unsubscribe(this.platforms[t]),this.platforms.splice(t,1)):this.platforms.splice(t)}destroyItems(){for(let t=this.items.length-1;t>=0;t--)this.items[t]?this.items[t].getCanDestroy()&&this.items.splice(t,1):this.items.splice(t)}getPlatforms(){return this.platforms}clearData(){this.platforms.forEach((t=>{t.destroy()})),this.items.forEach((t=>{t.destroy()})),this.platforms=[],this.items=[]}getRandomInRange(t,e){return Math.floor(Math.random()*(e-t+1))+t}};class W{constructor(){window.addEventListener("keydown",(t=>{W.keys[t.key]=!0})),window.addEventListener("keyup",(t=>{W.keys[t.key]=!1}))}static isDown(t){return this.keys[t]}static isDownButNotHold(t){return!!this.keys[t]&&(this.keys[t]=!1,!0)}}W.keys={};const V=W,z=class extends w{constructor(t,e,s,i){super(),this.transform=this.getComponent(a),null!=this.transform&&(this.transform.setPosition(e),this.transform.setScale(s),this.direction=i,this.forceAmount=t,this.timeToDestroy=5,this.currentTime=0,this.sprite=new d(this,x.BULLET),this.addComponent(this.sprite),this.start())}start(){this.collider=new i(this),this.collider.setBounds(this.transform.getPosition(),this.transform.getScale()),this.collider.setOffset(27),this.addComponent(this.collider),this.collider.setIsStatic(!1),this.rb=new r(this),this.rb.setUseGravity(!1),this.addComponent(this.rb)}update(t){this.currentTime+=t,this.currentTime>=this.timeToDestroy?this.destroy():this.rb.setVelocity(o.multiply(this.direction,this.forceAmount))}},X=class{fight(t,e){const s=new o(10,10);new z(1e3,t,s,e)}};var K;!function(t){t[t.LEFT_JUMP=0]="LEFT_JUMP",t[t.LEFT_NORMAL=1]="LEFT_NORMAL",t[t.RIGHT_JUMP=2]="RIGHT_JUMP",t[t.RIGHT_NORMAL=3]="RIGHT_NORMAL",t[t.FORWARD_JUMP=4]="FORWARD_JUMP",t[t.FORWARD_NORMAL=5]="FORWARD_NORMAL"}(K||(K={}));const Z=K,q=class extends w{constructor(){super(),this.transform.setLocalPosition(new o(-30,0)),this.sprite=new d(this),this.addComponent(this.sprite),this.takeAction(Z.LEFT_NORMAL)}takeAction(t){return t==Z.LEFT_NORMAL?this.sprite.setImage(x.LEFT_NORMAL):t==Z.LEFT_JUMP?this.sprite.setImage(x.LEFT_JUMP):t==Z.FORWARD_JUMP?this.sprite.setImage(x.FORWARD_JUMP):t==Z.FORWARD_NORMAL?this.sprite.setImage(x.FORWARD_NORMAL):t==Z.RIGHT_JUMP?this.sprite.setImage(x.RIGHT_JUMP):t==Z.RIGHT_NORMAL&&this.sprite.setImage(x.RIGHT_NORMAL),this.currentAction=t,this.sprite}getCurrentSprite(){return this.sprite}handleJumpSprite(){this.currentAction==Z.LEFT_NORMAL?this.takeAction(Z.LEFT_JUMP):this.currentAction==Z.RIGHT_NORMAL?this.takeAction(Z.RIGHT_JUMP):this.currentAction==Z.FORWARD_NORMAL&&this.takeAction(Z.FORWARD_JUMP)}handleNormalSprite(){this.currentAction==Z.LEFT_JUMP?this.takeAction(Z.LEFT_NORMAL):this.currentAction==Z.RIGHT_JUMP?this.takeAction(Z.RIGHT_NORMAL):this.currentAction==Z.FORWARD_JUMP&&this.takeAction(Z.FORWARD_NORMAL)}},Q=class{constructor(){this.setCurrentScore(0)}setCurrentScore(t){this.currentScore=t}addCurrentScore(t){this.currentScore+=t}getCurrentScore(){return this.currentScore}getHighScore(){return this.highScore}saveHighScore(){const t=localStorage.getItem("HighScore");if(t){const e=Number.parseInt(t);e<this.currentScore?(localStorage.setItem("HighScore",this.currentScore.toString()),this.highScore=this.currentScore):this.highScore=e}else this.highScore=this.currentScore,localStorage.setItem("HighScore",this.currentScore.toString())}},$=class extends d{constructor(t,e,s,i,n){super(t,n),this.text=e,this.textColor=s,this.width=i}draw(t,e){super.draw(t,e),t.fillStyle=this.textColor,t.font=y.Arial,t.textAlign="center",t.textBaseline="middle",t.fillText(this.text,e.x,e.y,this.width)}setTextDisplay(t){this.text=t}},tt=class extends w{constructor(){super()}setButton(t){this.button&&this.removeComponent(this.button),this.button=t,this.addComponent(this.button)}getButton(){return this.button}},et=class extends w{constructor(t=!1){super(t)}setText(t){this.text&&this.removeComponent(this.text),this.text=t,this.addComponent(this.text)}getText(){return this.text}},st=class extends w{constructor(t,e){var s,i,n,r,h,c;super(),this.setLayer(1),this.transform.setPosition(t),this.transform.setScale(e),this.panel=new d(this,x.BACKGROUND),this.addComponent(this.panel),this.playAgainButton=new tt,null===(s=this.playAgainButton.getComponent(a))||void 0===s||s.setLocalPosition(new o(280,350)),null===(i=this.playAgainButton.getComponent(a))||void 0===i||i.setScale(new o(224,82)),this.menuButton=new tt,this.menuButton.setLayer(-2),null===(n=this.menuButton.getComponent(a))||void 0===n||n.setLocalPosition(new o(350,500)),null===(r=this.menuButton.getComponent(a))||void 0===r||r.setScale(new o(224,82)),this.currentScoreText=new et,this.currentScoreText.setLayer(-2),null===(h=this.currentScoreText.getComponent(a))||void 0===h||h.setLocalPosition(new o(200,150)),this.highScoreText=new et,this.highScoreText.setLayer(-2),null===(c=this.highScoreText.getComponent(a))||void 0===c||c.setLocalPosition(new o(200,200)),this.addChild(this.playAgainButton),this.addChild(this.menuButton),this.addChild(this.currentScoreText),this.addChild(this.highScoreText),this.setUpUI()}setUpUI(){const t=new $(this.currentScoreText,"Your score: ","red",300,void 0);this.currentScoreText.setText(t);const e=new $(this.highScoreText,"High score: ","red",300,void 0);this.highScoreText.setText(e),new d(this.playAgainButton,x.PLAY_AGAIN_BUTTON);const s=new f(this.playAgainButton,"","",x.PLAY_AGAIN_BUTTON);this.playAgainButton.setButton(s);const i=new f(this.menuButton,"","",x.MENU_BUTTON);this.menuButton.setButton(i)}setHighScore(t){this.highScoreText.getText().setTextDisplay("High score: "+t.toString())}setCurrentScore(t){this.currentScoreText.getText().setTextDisplay("Current score: "+t.toString())}getPlayAgainButton(){return this.playAgainButton.getButton()}getMenuButton(){return this.menuButton.getButton()}},it=class extends w{constructor(t,e){var s,i;super(),this.panel=new d(this,x.BACKGROUND),this.addComponent(this.panel),this.startGameButton=new tt,null===(s=this.startGameButton.getComponent(a))||void 0===s||s.setLocalPosition(new o(100,200)),null===(i=this.startGameButton.getComponent(a))||void 0===i||i.setScale(new o(222,80)),this.doodleJumpText=new et,this.addChild(this.startGameButton),this.addChild(this.doodleJumpText),this.transform.setPosition(t),this.transform.setScale(e),this.setUpUI()}setUpUI(){const t=new f(this.startGameButton,"","",x.PLAY_GAME);this.startGameButton.setButton(t);const e=new $(this.doodleJumpText,"","",0,x.DOODLE_JUMP_TEXT);this.doodleJumpText.setText(e)}getStartGameButton(){return this.startGameButton.getButton()}},nt=class extends w{constructor(t,e){var s;super(!0),this.panel=new d(this,x.BACKGROUND),this.addComponent(this.panel),this.scoreText=new et(!0),null===(s=this.scoreText.getComponent(a))||void 0===s||s.setLocalPosition(new o(75,25)),this.scoreText.setLayer(-1),this.addChild(this.scoreText),this.transform.setPosition(t),this.transform.setScale(e),this.setUpUI()}setUpUI(){const t=new $(this.scoreText,"Score: 0","red",100,void 0);this.scoreText.setText(t)}setScoreText(t){this.scoreText.getText().setTextDisplay(t)}getScoreText(){return this.scoreText.getText()}};class ot{static getInstance(){return ot.instance||(ot.instance=new ot),ot.instance}constructor(){this.setUI()}setUI(){this.mainMenuUI=new it(new o(0,0),new o(640,600)),this.gameOverMenuUI=new st(new o(0,0),new o(640,600)),this.gamePlayUI=new nt(o.zero(),new o(640,600))}toggleMainMenu(t){this.mainMenuUI.setActive(t)}toggleGameOver(t){this.gameOverMenuUI.setActive(t)}toggleMainGameUI(t){this.gamePlayUI.setActive(t)}getStartGameButton(){return this.mainMenuUI.getStartGameButton()}getPlayAgainButton(){return this.gameOverMenuUI.getPlayAgainButton()}getMenuButton(){return this.gameOverMenuUI.getMenuButton()}getGameOverMenuUI(){return this.gameOverMenuUI}setScoreText(t){this.gamePlayUI.setScoreText("Score: "+t)}}const rt=ot,at=class extends w{constructor(t,e){super(),this.inputHandler=new V,this.transform.setPosition(t),this.transform.setScale(e),this.start()}start(){this.movementSpeed=450,this.jumpForce=700,this.canFly=!1,this.isOver=!1,this.movement=new R,this.collider=new i(this),this.collider.setOffset(110);const t=new o(this.transform.getPosition().x,this.transform.getPosition().y+this.collider.getOffset()),e=new o(this.transform.getScale().x,this.transform.getScale().y-this.collider.getOffset());this.collider.setBounds(t,e),this.addComponent(this.collider),this.collider.setIsStatic(!1),this.rb=new r(this),this.rb.setMass(400),this.rb.setUseGravity(!0),this.addComponent(this.rb),this.spawnProjectilePos=o.add(this.transform.getPosition(),new o(this.transform.getScale().x/2,-10)),this.playerModel=new q,this.addChild(this.playerModel),this.scoreCalculator=new Q,this.fighter=new X,this.previousHeight=this.transform.getPosition().y,this.maxHeight=300}update(t){super.update(t),this.isOver||(this.handleInput(t),this.updateSpawnProjectilePos(),this.handleTrigger(),this.handleFly(t),this.calculateHeight())}handleInput(t){if(V.isDown("ArrowLeft")){const e=o.left();this.movement.move(t,e,this.movementSpeed,this.transform),this.playerModel.takeAction(Z.LEFT_NORMAL)}if(V.isDown("ArrowRight")){const e=o.right();this.movement.move(t,e,this.movementSpeed,this.transform),this.playerModel.takeAction(Z.RIGHT_NORMAL)}}updateSpawnProjectilePos(){this.spawnProjectilePos=o.add(this.transform.getPosition(),new o(this.transform.getScale().x/2-5,-10))}handleTrigger(){this.collider.setIsTrigger(this.transform.getPosition().y<this.previousHeight),this.previousHeight=this.transform.getPosition().y,this.collider.getIsTrigger()?this.playerModel.handleJumpSprite():(this.publisher.setData(this.maxBorder),this.publisher.notify(),this.playerModel.handleNormalSprite())}handleFly(t){this.canFly&&(this.getPosition().y>this.maxHeightFlight?this.movement.move(t,o.up(),this.flySpeed,this.transform):(this.canFly=!1,this.rb.setUseGravity(!this.canFly)))}calculateHeight(){if(this.maxHeight>this.transform.getPosition().y){const t=Math.floor(this.maxHeight-this.transform.getPosition().y);this.setScore(t),this.maxHeight=this.transform.getPosition().y}}onCollisionEnter(t){t instanceof N?(t.operation(),t instanceof j&&this.rb.addForce(o.up(),t.getForceAmount()),t instanceof J&&(this.addChild(t),this.maxHeightFlight=-t.getMaxDistanceFlight()+this.transform.getPosition().y,this.canFly=!0,this.rb.setUseGravity(!this.canFly),this.flySpeed=t.getFlySpeed())):t instanceof E&&(t.operation(),t.getCanJump()&&(this.rb.setVelocity(o.zero()),this.rb.addForce(o.up(),this.jumpForce)))}setPublisher(t){this.publisher=t}getPosition(){return this.transform.getPosition()}setPosition(t){this.transform.setPosition(t)}setScore(t){this.scoreCalculator.addCurrentScore(t),rt.getInstance().setScoreText(this.scoreCalculator.getCurrentScore().toString())}setMaxBorder(t){this.maxBorder=t}saveHighScore(){this.scoreCalculator.saveHighScore(),rt.getInstance().getGameOverMenuUI().setHighScore(this.scoreCalculator.getHighScore()),rt.getInstance().getGameOverMenuUI().setCurrentScore(this.scoreCalculator.getCurrentScore())}clearData(){this.setPosition(new o(this.getPosition().x,0)),this.scoreCalculator.setCurrentScore(0),rt.getInstance().setScoreText("0")}setIsOver(t){this.isOver=t}},ht=class extends w{constructor(t){super(),this.uiManager=rt.getInstance(),this.screenSize=t,this.gotoMenu(),this.uiManager.getStartGameButton().subscribe((()=>{this.gotoGamePlay()})),this.uiManager.getPlayAgainButton().subscribe((()=>{this.gotoGamePlay()})),this.uiManager.getMenuButton().subscribe((()=>{this.gotoMenu()}))}gotoMenu(){this.uiManager.toggleMainMenu(!0),this.uiManager.toggleGameOver(!1),this.uiManager.toggleMainGameUI(!1),this.gameState=S.MAIN_MENU}gotoGamePlay(){this.uiManager.toggleGameOver(!1),this.uiManager.toggleMainMenu(!1),this.uiManager.toggleMainGameUI(!0),this.setUpGame(),this.gameState=S.GAME_PLAY}gotoGameOver(){this.uiManager.toggleGameOver(!0),this.uiManager.toggleMainMenu(!1),this.uiManager.toggleMainGameUI(!1)}getGameState(){return this.gameState}setGameState(t){this.gameState=t}setUpGame(){this.player&&this.player.destroy(),this.preDistance=0;const t=new o(320,300),e=new o(60,120);this.player=new at(t,e),this.platformManager=new Y,this.player.setPublisher(this.platformManager.getPublisher());const s=new o(t.x-50,550),i=new o(120,35);this.platformManager.createStablePlatform(s,i)}update(t){this.moveScreen(this.getGameState()==S.GAME_PLAY),this.getGameState()==S.GAME_PLAY?(this.platformManager.createPlatforms(this.screenSize.x),this.platformManager.destroyPlatforms(),this.platformManager.destroyItems(),this.handlePlayer(),this.uiManager.toggleMainGameUI(!0)):this.getGameState()==S.GAME_OVER&&(u.getInstance().getCurrentActiveScene().setCanvasMoveY(0),this.handleBorder())}moveScreen(t){var e;const s=u.getInstance().getCurrentActiveScene();if(t&&(null===(e=this.player)||void 0===e?void 0:e.getComponent(a))){const t=this.screenSize.y/2-125,e=t-this.player.getPosition().y;this.player.getPosition().y<t&&e>this.preDistance&&(this.player.setMaxBorder(e),s.setCanvasMoveY(e),this.preDistance=e)}}handlePlayer(){this.handleBorder();const t=this.platformManager.getTheFirstPlatform();null!=t&&this.player.getPosition().y-t.getTransform().getPosition().y>50&&(this.setGameState(S.GAME_OVER),this.player.saveHighScore(),this.player.setIsOver(!0),this.platformManager.clearData(),this.gotoGameOver(),this.player.clearData())}handleBorder(){if(this.player.getPosition().x>this.screenSize.x){const t=new o(0,this.player.getPosition().y);this.player.setPosition(t)}if(this.player.getPosition().x<-60){const t=new o(640,this.player.getPosition().y);this.player.setPosition(t)}}};new class{constructor(){new x;const t=new o(640,600);this.engineGame=new v(t.x,t.y),this.engineGame.createScene("GamePlay"),new ht(t)}}})();